<!DOCTYPE html>
<html>
    <head>
        <title>Admin Panel</title>
        <link rel="stylesheet" href="/static/styles/index.css"> 
    </head>
    <body class="center-vertical">
        <script>
            async function deleteUser(id) {
                await fetch("/api/delete",
                    {
                        method: 'POST',
                        headers: {'Content-Type': "application/json"},
                        body: JSON.stringify({ target:id })
                    }
                )
            }

            async function loadUsers() { 
                await fetch("/api/users")
                    .then(response => response.json())
                    .then(data => {
                        const users = data;
                        console.log(users);
                        users.forEach(user => {
                            const card = document.createElement('div');
                            card.className = 'card br-med usercard';
                            card.style = "width: 75%;";
                            
                            const username = document.createElement('p');
                            username.innerText = `Username: ${user.username}`;
                            card.appendChild(username);

                            const id = document.createElement('p');
                            id.innerText = `ID: ${user.id}`;
                            card.appendChild(id);

                            const permlevel = document.createElement('p');

                            permsInt = user.permissionLevel;
                            perms = "User";
                            if (permsInt === 1) {
                                perms = "Admin";
                            } else if (permsInt === 2) {
                                perms = "Owner";
                            }

                            permlevel.innerText = `Permission Level: ${perms}`;
                            card.appendChild(permlevel);

                            const kills = document.createElement('p');
                            kills.innerText = `Kills: ${user.kills}`;
                            card.appendChild(kills);

                            if (user.permissionLevel !== 2) {
                                const delButton = document.createElement('button');
                                delButton.className = "delete";

                                delButton.addEventListener('click', () => {
                                  deleteUser(user.id);  
                                })
                                
                                const delIcon = document.createElement('svg');
                                delIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path d="M11 1.75V3h2.25a.75.75 0 0 1 0 1.5H2.75a.75.75 0 0 1 0-1.5H5V1.75C5 .784 5.784 0 6.75 0h2.5C10.216 0 11 .784 11 1.75ZM4.496 6.675l.66 6.6a.25.25 0 0 0 .249.225h5.19a.25.25 0 0 0 .249-.225l.66-6.6a.75.75 0 0 1 1.492.149l-.66 6.6A1.748 1.748 0 0 1 10.595 15h-5.19a1.75 1.75 0 0 1-1.741-1.575l-.66-6.6a.75.75 0 1 1 1.492-.15ZM6.5 1.75V3h3V1.75a.25.25 0 0 0-.25-.25h-2.5a.25.25 0 0 0-.25.25Z"></path></svg>`;
                                delButton.appendChild(delIcon);

                                card.appendChild(delButton);

                                if (user.permissionLevel === 0) {
                                    const promoteButton = document.createElement('button');
                                    promoteButton.className = "promote";
                                    
                                    const promoteIcon = document.createElement('svg');
                                    promoteIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path d="M7.823 1.677 4.927 4.573A.25.25 0 0 0 5.104 5H7.25v3.236a.75.75 0 1 0 1.5 0V5h2.146a.25.25 0 0 0 .177-.427L8.177 1.677a.25.25 0 0 0-.354 0ZM13.75 11a.75.75 0 0 0 0 1.5h.5a.75.75 0 0 0 0-1.5h-.5Zm-3.75.75a.75.75 0 0 1 .75-.75h.5a.75.75 0 0 1 0 1.5h-.5a.75.75 0 0 1-.75-.75ZM7.75 11a.75.75 0 0 0 0 1.5h.5a.75.75 0 0 0 0-1.5h-.5ZM4 11.75a.75.75 0 0 1 .75-.75h.5a.75.75 0 0 1 0 1.5h-.5a.75.75 0 0 1-.75-.75ZM1.75 11a.75.75 0 0 0 0 1.5h.5a.75.75 0 0 0 0-1.5h-.5Z"></path></svg>`;
                                    promoteButton.appendChild(promoteIcon);

                                    card.appendChild(promoteButton);
                                } else {
                                    const promoteButton = document.createElement('button');
                                    promoteButton.className = "demote";
                                    
                                    const promoteIcon = document.createElement('svg');
                                    promoteIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path d="M7.823 1.677 4.927 4.573A.25.25 0 0 0 5.104 5H7.25v3.236a.75.75 0 1 0 1.5 0V5h2.146a.25.25 0 0 0 .177-.427L8.177 1.677a.25.25 0 0 0-.354 0ZM13.75 11a.75.75 0 0 0 0 1.5h.5a.75.75 0 0 0 0-1.5h-.5Zm-3.75.75a.75.75 0 0 1 .75-.75h.5a.75.75 0 0 1 0 1.5h-.5a.75.75 0 0 1-.75-.75ZM7.75 11a.75.75 0 0 0 0 1.5h.5a.75.75 0 0 0 0-1.5h-.5ZM4 11.75a.75.75 0 0 1 .75-.75h.5a.75.75 0 0 1 0 1.5h-.5a.75.75 0 0 1-.75-.75ZM1.75 11a.75.75 0 0 0 0 1.5h.5a.75.75 0 0 0 0-1.5h-.5Z"></path></svg>`;
                                    promoteButton.appendChild(promoteIcon);

                                    card.appendChild(promoteButton);
                                }
                            }

                            document.body.appendChild(card);
                        });
                    })
            }

            loadUsers();
        </script>
    </body>
</html>